<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rythum's European Grand Tour & Weather</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root {
            --terracotta: #E2725B;
            --azure: #3498DB;
            --gold: #F1C40F;
            --stone: #2C3E50;
            --paper: #FCF9F2;
        }

        body { 
            font-family: 'Georgia', serif; 
            margin: 0; 
            display: flex; 
            flex-direction: column; 
            height: 100vh; 
            background-color: var(--paper);
            background-image: linear-gradient(rgba(252, 249, 242, 0.92), rgba(252, 249, 242, 0.92)), 
                              url('https://images.unsplash.com/photo-1467269204594-9661b134dd2b?auto=format&fit=crop&q=80&w=2000');
            background-size: cover;
            background-attachment: fixed;
        }

        @media (min-width: 768px) {
            body { flex-direction: row; }
            #sidebar { width: 420px; height: 100vh; border-right: 3px double var(--terracotta); }
            #map { height: 100vh; }
        }

        #sidebar { 
            padding: 30px; 
            overflow-y: auto; 
            box-sizing: border-box; 
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(5px);
        }

        #map { height: 350px; flex-grow: 1; z-index: 1; border-bottom: 3px solid var(--terracotta); }

        h1 { font-style: italic; color: var(--terracotta); margin-bottom: 5px; font-size: 1.8rem; text-align: center; }
        
        /* Weather & Status Styles */
        #status-card {
            background: var(--stone);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .weather-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        .temp { font-size: 1.5rem; font-weight: bold; color: var(--gold); }
        .condition { font-size: 0.85rem; text-transform: capitalize; opacity: 0.9; }

        /* Timeline Styles */
        .timeline { list-style: none; padding: 0; position: relative; }
        .timeline::before {
            content: ''; position: absolute; left: 15px; top: 0; bottom: 0;
            width: 2px; background: var(--terracotta); opacity: 0.3;
        }
        .step { margin-bottom: 30px; padding-left: 45px; position: relative; cursor: pointer; }
        .step::before { content: 'â€¢'; position: absolute; left: 6px; top: -5px; font-size: 40px; color: var(--stone); }
        .step.completed::before { color: var(--terracotta); content: 'âœ“'; font-size: 24px; left: 8px; top: 2px; }
        .step.active::before { color: var(--azure); animation: pulse 2s infinite; }

        @keyframes pulse {
            0% { transform: scale(1); text-shadow: 0 0 0px var(--azure); }
            50% { transform: scale(1.3); text-shadow: 0 0 10px var(--azure); }
            100% { transform: scale(1); }
        }

        .location { font-size: 1.1rem; font-weight: bold; color: #1a1a1a; }
        .info { font-size: 0.85rem; color: #555; font-style: italic; }

        .marker-past { filter: hue-rotate(340deg) saturate(1.5); }
        .marker-current { filter: hue-rotate(180deg) brightness(1.2); }
        .marker-future { filter: grayscale(1); opacity: 0.5; }
    </style>
</head>
<body>

<div id="map"></div>

<div id="sidebar">
    <h1>Bon Voyage, Rythum</h1>
    
    <div id="status-card">
        <div id="location-text">Detecting location...</div>
        <div id="weather-box" class="weather-info" style="display:none;">
            <div>
                <div class="condition" id="weather-desc">Clear Sky</div>
                <div style="font-size: 0.7rem; opacity: 0.7;">Current Weather</div>
            </div>
            <div class="temp" id="weather-temp">--Â°C</div>
        </div>
    </div>

    <ul class="timeline" id="timeline"></ul>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    const itinerary = [
        { date: "2026-02-14T10:00:00", label: "Toronto", info: "Flight Departure", lat: 43.6532, lng: -79.3832 },
        { date: "2026-02-15T09:00:00", label: "Rome", info: "The Eternal City", lat: 41.9028, lng: 12.4964 },
        { date: "2026-02-16T09:05:00", label: "Colosseum", info: "Ancient Wonders", lat: 41.8902, lng: 12.4922 },
        { date: "2026-02-17T09:42:00", label: "Venice", info: "Canals & Art", lat: 45.4408, lng: 12.3155 },
        { date: "2026-02-18T09:45:00", label: "Milan", info: "Fashion Capital", lat: 45.4642, lng: 9.1900 },
        { date: "2026-02-18T22:36:00", label: "Paris", info: "City of Light", lat: 48.8566, lng: 2.3522 },
        { date: "2026-02-21T18:30:00", label: "Eiffel Tower", info: "Final Farewell", lat: 48.8584, lng: 2.2945 }
    ];

    const map = L.map('map', { zoomControl: false }).setView([48, 2], 4); 
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png').addTo(map);

    async function fetchWeather(lat, lng) {
        try {
            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lng}&current_weather=true`);
            const data = await res.json();
            const weather = data.current_weather;
            
            document.getElementById('weather-box').style.display = 'flex';
            document.getElementById('weather-temp').innerText = `${Math.round(weather.temperature)}Â°C`;
            
            // Basic WMO Code mapping
            const codes = { 0: "Clear Sky", 1: "Mainly Clear", 2: "Partly Cloudy", 3: "Overcast", 45: "Fog", 61: "Rain" };
            document.getElementById('weather-desc').innerText = codes[weather.weathercode] || "Fair Conditions";
        } catch (e) { console.error("Weather load failed"); }
    }

    function update() {
        const now = new Date();
        const timelineEl = document.getElementById('timeline');
        timelineEl.innerHTML = '';
        
        itinerary.forEach((item, index) => {
            const itemDate = new Date(item.date);
            const nextDate = itinerary[index + 1] ? new Date(itinerary[index+1].date) : null;
            let status = 'future';
            let mClass = 'marker-future';

            if (now > itemDate && (!nextDate || now < nextDate)) {
                status = 'active'; mClass = 'marker-current';
                document.getElementById('location-text').innerHTML = `ðŸ“ Currently: <b>${item.label}</b>`;
                fetchWeather(item.lat, item.lng);
                map.flyTo([item.lat, item.lng], 10);
            } else if (now >= itemDate) {
                status = 'completed'; mClass = 'marker-past';
            }

            const marker = L.marker([item.lat, item.lng]).addTo(map);
            marker._icon.classList.add(mClass);

            const li = document.createElement('li');
            li.className = `step ${status}`;
            li.innerHTML = `
                <div class="location">${item.label}</div>
                <div class="info">${item.info}</div>
            `;
            li.onclick = () => map.flyTo([item.lat, item.lng], 13);
            timelineEl.appendChild(li);
        });
    }

    update();
</script>
</body>
</html>
